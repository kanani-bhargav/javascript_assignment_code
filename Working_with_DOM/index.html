<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working with dom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <div class="container-fluid">
        <div class="d-flex justify-content-around">
            <button class="btn btn-outline-success mb-3" id="thisbtn">show data</button>
            <button class="btn btn-outline-primary mb-3" id="addbtn" data-bs-toggle="modal" data-bs-target="#myModal"
                onclick="updatebtn.style.display = 'none'">add data</button>
            <button class="btn btn-outline-danger mb-3" id="removebtn">remove data</button>
        </div>
        <table class="table table-dark table-striped ">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>User Name</th>
                    <th>Email</th>
                    <th>Address</th>
                    <th>Phone</th>
                    <th>Website</th>
                    <th>company</th>
                    <th colspan="2">action</th>
                </tr>
            </thead>
            <tbody id="record">
            </tbody>
        </table>

    </div>
    <div class="modal fade " id="myModal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content ">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Add User</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <!-- Modal body -->
                <div class="modal-body ">
                    <form>
                        <div class="row">
                            <div class="mx-auto col-6 mb-3">
                                <label for="name" class="form-label">Name :</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter name">
                            </div>
                            <div class="mx-auto col-6 mb-3">
                                <label for="username" class="form-label">User Name :</label>
                                <input type="text" class="form-control" id="username" placeholder="Enter name">
                            </div>
                            <div class="mx-auto col-6 mb-3">
                                <label for="email" class="form-label">Email:</label>
                                <input type="email" class="form-control" id="email" placeholder="Enter email">
                            </div>
                            <div class="mx-auto col-6 mb-3">
                                <label for="phone" class="form-label">Phone:</label>
                                <input type="tel" class="form-control" id="phone" placeholder="Enter Phone" name="pswd"
                                    pattern="[0-9]">
                            </div>
                            <div class="mx-auto col-6 mb-3">
                                <label for="web" class="form-label">Website:</label>
                                <input type="text" class="form-control" id="web" placeholder="Website">
                            </div>
                            <div class="mx-auto col-6 mb-3">
                                <label for="company" class="form-label">company:</label>
                                <input type="text" class="form-control" id="company" placeholder="Enter company"
                                    name="pswd" pattern="[0-9]">
                            </div>
                            <div class="mx-auto col-12 mb-3 d-flex">
                                <label for="company" class="form-label">Address:</label>
                                <div class="col-auto mx-auto">
                                    <input type="text" class="form-control " id="city" placeholder="Enter city"
                                        name="pswd" pattern="[0-9]">
                                </div>
                                <div class="col-auto">
                                    <input type="text mx-auto" class="form-control " id="street"
                                        placeholder="Enter street" name="pswd" pattern="[0-9]">
                                </div>
                                <div class="col-auto mx-auto">
                                    <input type="text" class="form-control " id="zipcode" placeholder="Enter zipcode"
                                        name="pswd" pattern="[0-9]">
                                </div>

                            </div>
                        </div>
                        <button type="button" data-bs-dismiss="modal" value="submit" id="adduser"
                            class="btn btn-success">Submit</button>
                        <button type="button" data-bs-dismiss="modal" value="submit" id="updatebtn"
                            class="btn btn-primary">update</button>
                    </form>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>

                <script>
                    let btn = document.getElementById("thisbtn");
                    let addbtn = document.getElementById("addbtn");
                    let removebtn = document.getElementById("removebtn")
                    let adduser = document.getElementById("adduser")
                    let updatebtn = document.getElementById("updatebtn")
                    addbtn.style.display = "none"
                   

                    let fetchdata = async () => {
                        await fetch("https://jsonplaceholder.typicode.com/users").then((response) => response.json()).then((json) => {
                            localStorage.setItem("store", JSON.stringify(json))
                        })
                    }

                    btn.addEventListener("click", showdata)
                    async function showdata() {
                        await fetchdata()
                        let data = JSON.parse(localStorage.getItem("store"))
                        viewdata(data)
                        thisbtn.style.display = "none"
                        addbtn.style.display = "inline-block"
                    }

                    adduser.addEventListener("click", adddata)
                    async function adddata() {
                        if ((localStorage.getItem("userkey" == null) || localStorage.getItem("userkey") == undefined)) {
                            await fetchdata()
                            let adddata = JSON.parse(localStorage.getItem("store"))
                            userdata(adddata)
                        }
                        else {
                            let adddata = JSON.parse(localStorage.getItem("userkey"))
                            userdata(adddata)
                        }
                    }
                    function userdata(adddata) {
                        let name = document.getElementById("name").value
                        let username = document.getElementById("username").value
                        let email = document.getElementById("email").value
                        let phone = document.getElementById("phone").value
                        let web = document.getElementById("web").value
                        let company = document.getElementById("company").value
                        let city = document.getElementById("city").value
                        let street = document.getElementById("street").value
                        let zipcode = document.getElementById("zipcode").value

                        let obj = {
                            id: (adddata[adddata.length - 1].id + 1),
                            name: name,
                            username: username,
                            email: email,
                            address: {
                                city: city,
                                street: street,
                                zipcode: zipcode,
                            },
                            phone: phone,
                            website: web,
                            company: { name: company },

                        }
                        adddata.push(obj);
                        viewdata(adddata)

                        document.getElementById("name").value = ""
                        document.getElementById("username").value = ""
                        document.getElementById("email").value = ""
                        document.getElementById("phone").value = ""
                        document.getElementById("web").value = ""
                        document.getElementById("company").value = ""
                        document.getElementById("city").value = ""
                        document.getElementById("street").value = ""
                        document.getElementById("zipcode").value = ""

                        localStorage.setItem("userkey", JSON.stringify(adddata))
                    }

                    function viewdata(input) {
                        let arr = input;
                        let tbl = "";
                        arr.map((val) => {
                            tbl += `
                <tr>
                    <td>${val.id}</td>
                    <td>${val.name}</td>
                    <td>${val.username}</td>
                    <td>${val.email}</td>
                    <td >
                        <div>City - ${val.address.city}</div>
                        <div>Street - ${val.address.street}</div>
                        <div>Zipcode -${val.address.zipcode}</div>
                        </td>
                        <td>${val.phone}</td>
                        <td>${val.website}</td>
                        <td>${val.company.name}</td>
                        <td><button class="btn btn-danger" onclick=deleteData(${val.id})>delete</button></td>
                        <td><button class="btn btn-secondary" onclick=updateData(${val.id}) data-bs-toggle="modal"
                data-bs-target="#myModal" >update</button></td>
                        </tr>
                        `
                            document.getElementById("record").innerHTML = tbl
                        })
                    }

                    function deleteData(id) {
                        if ((localStorage.getItem("userkey" == null) || localStorage.getItem("userkey") == undefined)) {
                            let data = JSON.parse(localStorage.getItem("store"))
                            for (let i in data) {
                                if (data[i].id == id) {
                                    data.splice(i, 1)
                                }
                            }
                            localStorage.setItem("store", JSON.stringify(data))
                            let deleteitem = JSON.parse(localStorage.getItem("store"))
                            viewdata(deleteitem)
                            localStorage.setItem("userkey", JSON.stringify(data))
                        }
                        else {
                            let data = JSON.parse(localStorage.getItem("userkey"))
                            for (let i in data) {
                                if (data[i].id == id) {
                                    data.splice(i, 1)
                                }
                            }
                            localStorage.setItem("userkey", JSON.stringify(data))
                            let deleteitem = JSON.parse(localStorage.getItem("userkey"))
                            viewdata(deleteitem)
                        }
                    }

                  async  function updateData(id) {
                        let userid=id
                        // console.log(userid);
                        adduser.style.display = "none"
                        updatebtn.style.display = "inline-block"
                        let data = JSON.parse(localStorage.getItem("userkey"))
                        for (let i in data) {
                            if (data[i].id == userid) {
                                document.getElementById("name").value = data[i].name
                                document.getElementById("username").value = data[i].username
                                document.getElementById("email").value = data[i].email
                                document.getElementById("phone").value = data[i].phone
                                document.getElementById("web").value = data[i].website
                                document.getElementById("company").value = data[i].company.name
                                document.getElementById("city").value = data[i].address.city
                                document.getElementById("street").value = data[i].address.street
                                document.getElementById("zipcode").value = data[i].address.zipcode
                                
                            }
                            
                        }
                        updatebtn.addEventListener("click",updateuser(id))
                    }
                    function updateuser(id) {
                                let userid=id
                              let udata = JSON.parse(localStorage.getItem("userkey"))

                            for (let i in udata) {
                                if (udata[i].id == userid) {
                                    console.log(userid);
                                    udata[i].name =document.getElementById("name").value
                                    udata[i].username=document.getElementById("username").value
                                    udata[i].email=document.getElementById("email").value
                                    udata[i].phone=document.getElementById("phone").value
                                    udata[i].website=document.getElementById("web").value
                                    udata[i].company.name= document.getElementById("company").value
                                    udata[i].address.city=document.getElementById("city").value
                                    udata[i].address.street=document.getElementById("street").value
                                    udata[i].address.zipcode=document.getElementById("zipcode").value
                                    console.log(udata[i].name);

                              
                                }
                            }
                            localStorage.setItem("userkey", JSON.stringify(udata))
                            let newdata = JSON.parse(localStorage.getItem("userkey"))
                            viewdata(newdata)
                        }
                        removebtn.addEventListener("click", removehandler)
                        function removehandler() {
                            let allremove = localStorage.removeItem("store");
                            document.getElementById("record").innerHTML = ""
                        }

                </script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                    crossorigin="anonymous"></script>
</body>

</html>